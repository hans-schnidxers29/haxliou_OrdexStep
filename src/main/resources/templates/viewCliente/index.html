<!DOCTYPE html>
<html lang="es"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity6"
      layout:decorate="~{layouts/adminlte}">
<head>
    <title>Listado de Clientes</title>
</head>

<body>
<div layout:fragment="content">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1><i class="fas fa-users mr-2"></i> Listado de Clientes</h1>
                </div>
                <div class="col-sm-6 text-right">
                    <a th:href="@{/crearcliente/nuevo}" class="btn btn-primary shadow-sm">
                        <i class="fas fa-plus-circle mr-1"></i> Nuevo Cliente
                    </a>
                </div>
            </div>
        </div>
    </section>

    <section class="content">
        <div class="container-fluid">

            <div th:if="${Error}" class="alert alert-danger alert-dismissible shadow">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">×</button>
                <h5><i class="icon fas fa-ban"></i> Error</h5>
                <span th:text="${Error}">Error al guardar</span>
            </div>

            <div class="card card-outline card-primary shadow">
                <div class="card-header">
                    <h3 class="card-title">Clientes Registrados</h3>
                </div>

                <div class="card-body">
                    <div th:if="${#lists.isEmpty(clientes)}" class="text-center p-5">
                        <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                        <h4>No hay clientes registrados todavía.</h4>
                        <a th:href="@{/crearcliente/nuevo}" class="btn btn-outline-primary mt-2">Crear primer cliente</a>
                    </div>

                    <table th:unless="${#lists.isEmpty(clientes)}" id="tablaClientes" class="table table-bordered table-striped table-hover w-100">
                        <thead>
                        <tr>
                            <th>Nombre</th>
                            <th>Apellido</th>
                            <th>Email</th>
                            <th>Teléfono</th>
                            <th>Ciudad</th>
                            <th>Pedidos</th>
                            <th class="text-center">Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="cliente : ${clientes}">
                            <td th:text="${cliente.nombre}"></td>
                            <td th:text="${cliente.apellido}"></td>
                            <td th:text="${cliente.email}"></td>
                            <td th:text="${cliente.telefono}"></td>
                            <td th:text="${cliente.ciudad}"></td>
                            <td class="text-center">
                                <span class="badge badge-info" th:text="${cliente.pedidos.size()}">0</span>
                            </td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <a th:href="@{/cliente/actualizar/{id}(id=${cliente.id})}"
                                       class="btn btn-warning btn-sm mr-1" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/cliente/delete/{id}(id=${cliente.id})}"
                                       class="btn btn-danger btn-sm"
                                       onclick="return confirmarEliminacion('¿Estás seguro de eliminar este cliente?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="card-footer" th:unless="${#lists.isEmpty(clientes)}">
                    <span class="text-muted small">Total: <strong th:text="${clientes.size()}">0</strong> registros</span>
                </div>
            </div>
        </div>
    </section>
</div>

<th:block layout:fragment="scripts">
    <script>
        $(document).ready(function () {
            $("#tablaClientes").DataTable({
                "responsive": true,
                "lengthChange": true,
                "autoWidth": false,
                "paging": true,      // Aseguramos que esté activo
                "searching": true,   // Aseguramos que esté activo
                "ordering": true,
                "info": true,
                "language": {
                    "url": "https://cdn.datatables.net/plug-ins/1.10.24/i18n/Spanish.json"
                },
                "columnDefs": [
                    { "orderable": false, "targets": 6 } // La columna de acciones no se ordena
                ]
            });
        });
    </script>
</th:block>

</body>
</html>