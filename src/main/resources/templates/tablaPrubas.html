<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link href="https://cdn.datatables.net/2.3.5/css/dataTables.dataTables.css" rel="stylesheet">
</head>
<body>
<table id="example" class="display">
    <thead>
    <tr>
    <tr>
        <th><i class="fas fa-hashtag me-2"></i>ID</th>
        <th><i class="fas fa-user me-2"></i>Cliente</th>
        <th><i class="fas fa-calendar me-2"></i>Fecha Pedido</th>
        <th><i class="fas fa-truck me-2"></i>Fecha Entrega</th>
        <th><i class="fas fa-list me-2"></i>Productos</th>
        <th><i class="fas fa-dollar-sign me-2"></i>Total</th>
        <th><i class="fas fa-tasks me-2"></i>Estado</th>
        <th class="text-center"><i class="fas fa-cog me-2"></i>Acciones</th>
        <th class="text-center"><i class="fas fa-cog me-2"></i>Acciones</th>
    </tr>
    </thead>
    <tbody>
    <!-- 游꿛 CLASE DIN츼MICA SEG칔N EL ESTADO DEL PEDIDO -->
    <tr th:each="pedido : ${pedidos}"
        th:class="${pedido.estado.name() == 'ENTREGADO'} ? 'fila-entregado' :
                               (${pedido.estado.name() == 'CANCELADO'} ? 'fila-cancelado' :
                               (${pedido.estado.name() == 'PENDIENTE'} ? 'fila-pendiente' :
                               (${pedido.estado.name() == 'PROCESANDO'} ? 'fila-procesando' :
                               (${pedido.estado.name() == 'ENVIADO'} ? 'fila-enviado' : ''))))">
        <td>
            <strong>#<span th:text="${pedido.id}">ID</span></strong>
        </td>
        <td>
            <strong th:text="${pedido.cliente.nombre}">Cliente</strong>
            <br>
            <small class="info-pedido" th:text="${pedido.cliente.email}">email</small>
        </td>
        <td>
            <span th:text="${#temporals.format(pedido.fechaPedido, 'dd/MM/yyyy')}">Fecha</span>
            <br>
            <small class="info-pedido" th:text="${#temporals.format(pedido.fechaPedido, 'HH:mm')}">Hora</small>
        </td>
        <td>
            <span th:text="${#temporals.format(pedido.fechaEntrega, 'dd/MM/yyyy')}">Fecha</span>
        </td>
        <td>
            <span class="badge bg-info" th:text="${pedido.detalles.size()} + ' item(s)'">0</span>
        </td>
        <td>
                        <span class="total-destacado">
                            $<span th:text="${#numbers.formatDecimal(pedido.total, 1, 3)}">0.000</span>
                        </span>
        </td>
        <td>
                        <span th:class="'badge-estado badge-' + ${pedido.estado.name().toLowerCase()}"
                              th:text="${pedido.estado}">Estado</span>
        </td>
        <td class="text-center">
            <a th:href="@{/pedidos/ver/{id}(id=${pedido.id})}"
               class="btn btn-secondary btn-sm me-1"
               title="Ver Detalles">
                <i class="fas fa-eye"></i> Ver
            </a>
            <a th:href="@{/pedidos/editar/{id}(id=${pedido.id})}"
               class="btn btn-info btn-sm me-1"
               title="Editar"
               th:disabled="${pedido.estado.name() == 'ENTREGADO' || pedido.estado.name() == 'CANCELADO'}">
                <i class="fas fa-edit"></i> Editar
            </a>
            <a th:href="@{/pedidos/eliminar/{id}(id=${pedido.id})}"
               class="btn btn-danger btn-sm"
               onclick="return confirmarEliminacion('쮼st치s seguro de eliminar este pedido?')"
               title="Eliminar">
                <i class="fas fa-trash"></i> Eliminar
            </a>
        </td>
        <td class="text-center">
            <!-- Bot칩n Entregar - Solo visible si NO est치 entregado ni cancelado -->
            <a th:href="@{/pedidos/Entregar/{id}(id=${pedido.id})}"
               class="btn btn-success btn-sm me-1"
               title="Marcar como Entregado"
               th:if="${pedido.estado.name() != 'ENTREGADO' && pedido.estado.name() != 'CANCELADO'}"
               onclick="return confirm('쮺onfirmas que el pedido ha sido entregado?')">
                <i class="fas fa-check-circle"></i> Entregar
            </a>

            <!-- Bot칩n Cancelar - Solo visible si NO est치 entregado ni cancelado -->
            <a th:href="@{/pedidos/Cancelar/{id}(id=${pedido.id})}"
               class="btn btn-danger btn-sm"
               title="Cancelar Pedido"
               th:if="${pedido.estado.name() != 'ENTREGADO' && pedido.estado.name() != 'CANCELADO'}"
               onclick="return confirm('쮼st치s seguro de cancelar este pedido?')">
                <i class="fas fa-times-circle"></i> Cancelar
            </a>

            <!-- Mensaje cuando est치 entregado -->
            <span th:if="${pedido.estado.name() == 'ENTREGADO'}"
                  class="badge bg-success">
                            <i class="fas fa-check-double"></i> Entregado
                        </span>

            <!-- Mensaje cuando est치 cancelado -->
            <span th:if="${pedido.estado.name() == 'CANCELADO'}"
                  class="badge bg-danger">
                            <i class="fas fa-ban"></i> Cancelado
                        </span>
        </td>
    </tbody>
    <tfoot>
    <tr>
        <th><i class="fas fa-hashtag me-2"></i>ID</th>
        <th><i class="fas fa-user me-2"></i>Cliente</th>
        <th><i class="fas fa-calendar me-2"></i>Fecha Pedido</th>
        <th><i class="fas fa-truck me-2"></i>Fecha Entrega</th>
        <th><i class="fas fa-list me-2"></i>Productos</th>
        <th><i class="fas fa-dollar-sign me-2"></i>Total</th>
        <th><i class="fas fa-tasks me-2"></i>Estado</th>
        <th class="text-center"><i class="fas fa-cog me-2"></i>Acciones</th>
        <th class="text-center"><i class="fas fa-cog me-2"></i>Acciones</th>
    </tr>
    </tfoot>
</table>
<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="https://cdn.datatables.net/2.3.5/js/dataTables.js"></script>
<script>
    new DataTable('#example', {
        columnDefs: [
            {
                targets: 2,
                visible: false,
                searchable: false
            },
            {
                targets: 3,
                visible: false
            }
        ]
    });
</script>


</body>
</html>